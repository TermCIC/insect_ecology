<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>KAPLAY RPG Demo</title>
<script src="https://unpkg.com/kaplay/dist/kaplay.js"></script>
</head>

<body style="margin:0;background:black;">
<script>

const k = kaplay({
  background: [30, 30, 30],
  scale: 2,
});

// --- Load sprites ---
await loadSprite("hero", "https://i.imgur.com/Ur4JQ6L.png");
await loadSprite("wall", "https://i.imgur.com/4LGAZ8q.png");
await loadSprite("floor", "https://i.imgur.com/RSJhrxF.png");

// --- Tilemap data ---
const map = [
  "################",
  "#..............#",
  "#..............#",
  "#......##......#",
  "#..............#",
  "#......##......#",
  "#..............#",
  "################",
];

// Convert tilemap to objects
map.forEach((row, y) => {
  [...row].forEach((ch, x) => {

    if (ch === "#") {
      add([
        sprite("wall"),
        pos(x * 16, y * 16),
        area(),
        solid(),
      ]);
    }

    if (ch === ".") {
      add([
        sprite("floor"),
        pos(x * 16, y * 16),
      ]);
    }
  });
});

// --- Player ---
const player = add([
  sprite("hero"),
  pos(32, 32),
  area(),
  solid(),
  { speed: 80 }
]);

// Camera follow
player.onUpdate(() => {
  camPos(player.pos);
});

// Movement
onKeyDown("left", () => player.move(-player.speed, 0));
onKeyDown("right", () => player.move(player.speed, 0));
onKeyDown("up", () => player.move(0, -player.speed));
onKeyDown("down", () => player.move(0, player.speed));

</script>
</body>
</html>